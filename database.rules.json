{
  "rules": {
    "devices": {
      "$deviceId": {
        // Read: Only authenticated users can read device data
        ".read": "auth != null",
        // Write: Restricted based on ownership
        ".write": false,
        // Ownership fields - only owner can write
        "ownedBy": {
          ".read": "auth != null",
          ".write": "auth != null && (!data.exists() || data.val() == auth.uid)"
        },
        "connectedTo": {
          ".read": "auth != null",
          ".write": "auth != null && (!root.child('devices').child($deviceId).child('ownedBy').exists() || root.child('devices').child($deviceId).child('ownedBy').val() == auth.uid)"
        },
        "connectedAt": {
          ".read": "auth != null",
          ".write": "auth != null && (!root.child('devices').child($deviceId).child('ownedBy').exists() || root.child('devices').child($deviceId).child('ownedBy').val() == auth.uid)"
        },
        "fieldId": {
          ".read": "auth != null",
          ".write": "auth != null && (!root.child('devices').child($deviceId).child('ownedBy').exists() || root.child('devices').child($deviceId).child('ownedBy').val() == auth.uid)"
        },
        "paddyName": {
          ".read": "auth != null",
          ".write": "auth != null && (!root.child('devices').child($deviceId).child('ownedBy').exists() || root.child('devices').child($deviceId).child('ownedBy').val() == auth.uid)"
        },
        // Action fields - only owner can write
        "action": {
          ".read": "auth != null",
          // Allow authenticated users (the app UI) to request actions (e.g. ask device to fetch GPS)
          // Device ownership checks are still enforced for other sensitive writes elsewhere.
          ".write": "auth != null"
        },
        "actionTaken": {
          ".read": "auth != null",
          ".write": true
        },
        // NPK sensor data - ESP32 can write, users can read
        "npk": {
          ".read": "auth != null",
          ".write": true
        },
        // GPS location data - ESP32 can write, users can read
        "gps": {
          ".read": "auth != null",
          ".write": true
        },
        // Weather data - ESP32 can write, users can read
        "weather": {
          ".read": "auth != null",
          ".write": true
        },
        // Heartbeat - ESP32 can write, users can read
        "heartbeat": {
          ".read": "auth != null",
          ".write": true
        },
        // Status - ESP32 can write, users can read
        "status": {
          ".read": "auth != null",
          ".write": true
        },
        // Sensors data - ESP32 can write, users can read
        "sensors": {
          ".read": "auth != null",
          ".write": true
        },
        // Timestamp - allow ESP32 and owner to write
        "timestamp": {
          ".read": "auth != null",
          ".write": true
        },
        // Commands - authenticated users can send commands
        "commands": {
          ".read": "auth != null",
          ".write": "auth != null"
        },
        // Audit logs - authenticated users can write audit entries
        "audit": {
          ".read": "auth != null",
          ".write": "auth != null"
        }
      }
    }
    ,
    "control_panel_logs": {
      "$logId": {
        ".read": "auth != null",
        // Allow authenticated users (clients or functions) to push logs
        ".write": "auth != null"
      }
    }
  }
}
